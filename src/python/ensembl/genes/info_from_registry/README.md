# Ensembl Genes - Info From Registry Module

## Overview
The `info_from_registry` module is a Python component of the Ensembl Gene Annotation pipelines that interfaces with the Metadata Registry to retrieve database connection and metadata information. This module is specifically designed to support pipeline initialization and registry status update workflows.

## Purpose
This module serves as an interface between the Metadata Registry and the annotation pipeline, providing:

- **Registry Data Extraction**:  Gathers assembly-specific database and assembly information
- **Pipeline Initialization**: Provides necessary metadata to start annotation pipelines
- **Status Monitoring**: Tracks GCA status
- **Connection Management**: Handles database connection parameters and credentials

## Core Features
### Registry Integration
- Connects to the Metadata Registry
- Extracts database metadata (host, port, database names)
- Retrieves assembly information
- Handles authentication and secure connections

### Configuration Generation
- Creates pipeline configuration files
- Generates assembly-specific parameter sets
- Produces database connection strings
- Formats data for downstream pipeline consumption

## Main function
### Initialise non vertebrate pipeline

```bash
# Copy non_vert_pipeline_settings.json into your working directory
cp path/to/non_vert_pipeline_settings.json  path/to/working/directory

# Fill out details in non_vert_pipeline_settings
vim non_vert_pipeline_settings.json

# Create a file with a list of assembly accessions (no commas)
vim gcas

# Run script to collect info and initialise pipeline
python3 path/to/software/dir/ensembl-genes/src/python/ensembl/genes/info_from_registry/genebuild_nonvert.py --pipeline anno --gcas gcas --settings_file non_vert_pipeline_settings.json 
```

#### Expected behaviour
The script will create a non_vert_params.json for all provided GCAs. This file will contain all parameters needed to start the annotation pipeline. Based on the JSON an eHIVE pipline will be initialised (with force option!). Finally, GCAs are seeded into the pipeline (into analysis 1 by default). The script checks if a given GCA was annotated before. If it was it will throw an error. Please use `genebuild = 1` option to override behaviour. The script also assigns `stable ID` and writes it back to the registry. Clade settings can be found in the `clade_settings.json` file. Clade is assigned based on lowest taxon ID. `init_file` can be used to supress most behaviour and load from a file.


## Breakdown of files and scripts 
`anno_settings.json`
Contains basic settings for anno command generation.

`assing_clade_based_on_tax.py`
Created a taxonomy dictionary based on information stored in the taxonomy table in the registry.

`assign_species_prefix.py`

`build_anno_commands.py`
Creates anno command based on information gathered from the registry and the clade settings.

`check_if_annotated.py`
Checks if a GCA has already been annotated and gives back an error message if it has been.

`clade_settings.json`
Holds pipeline settings based on clade/taxon ID.

`create_config.py`
Copies and edits config file specified in non_vert_settings.json.

`genebuild_nonvert.py`
Main script that initialises and seeds pipeline after gathering all information.

`mysql_helper.py`
Script to access and edit information in the registry.

`seed_nonvert.py`
Seeds pipeline analysis 1 by default.

`start_pipeline_from_registry.py`
Creates non_vert_pipeline_params.json with all parameters from the registry and parameters generated by the scripts.
